<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‚ú® Smart Style Mirror ‚Äì Your AI Fashion Buddy üé§</title>
  <style>
    :root{
      --glass: rgba(255,255,255,.15);
      --text: #ffffff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
      color:var(--text);
      background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      position:relative;
    }
    h1{
      margin:20px;
      font-size:clamp(24px,5vw,36px);
      font-weight:700;
      text-align:center;
      color:#fff;
      text-shadow:0 0 8px #ff5e62,0 0 16px #ff9966,0 0 24px #ff5e62;
      animation:glow 3s ease-in-out infinite alternate;
      z-index:1;
    }
    @keyframes glow{
      from{text-shadow:0 0 8px #ff5e62,0 0 16px #ff9966;}
      to{text-shadow:0 0 20px #ff9966,0 0 40px #ff5e62;}
    }
    .container{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:20px;
      width:90%;
      max-width:1100px;
      z-index:1;
    }
    .glass{
      background:var(--glass);
      border:1px solid rgba(255,255,255,.25);
      border-radius:20px;
      backdrop-filter:blur(12px);
      box-shadow:0 8px 30px rgba(0,0,0,.4);
      padding:20px;
    }
    video,canvas,img{
      border-radius:16px;
      border:2px solid rgba(255,255,255,.5);
      max-width:100%;
    }
    #controls{
      display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px;
    }
    button{
      background:linear-gradient(90deg,#ff9966,#ff5e62);
      color:white;border:0;border-radius:50px;
      padding:10px 16px;font-size:14px;cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.3);
      transition:.25s transform, .25s box-shadow;
    }
    button:hover{transform:translateY(-2px); box-shadow:0 8px 20px rgba(0,0,0,.5)}
    button.secondary{background:linear-gradient(90deg,#00c6ff,#0072ff)}
    #suggestion{padding:14px;font-weight:600;text-align:center;font-size:16px}
    #palette{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:14px}
    .swatch{
      width:50px;height:50px;border-radius:14px;border:2px solid rgba(255,255,255,.8);
      animation:pop 0.6s ease;
    }
    @keyframes pop{
      0%{transform:scale(0.7);opacity:0;}
      100%{transform:scale(1);opacity:1;}
    }
    #micButton{
      position:fixed;bottom:20px;right:20px;
      width:70px;height:70px;border-radius:50%;
      background:linear-gradient(135deg,#ff5e62,#ff9966);
      border:none;display:flex;align-items:center;justify-content:center;
      box-shadow:0 8px 20px rgba(0,0,0,.5);
      cursor:pointer;
      transition:.25s transform;
      z-index:2;
    }
    #micButton:hover{transform:scale(1.1)}
    #micButton svg{width:30px;height:30px;fill:#fff}
    #captured{margin-top:12px;max-width:100%}
    #downloadLink{color:#fff;text-decoration:none;font-weight:700;display:block;margin-top:10px}
    #tip{font-size:12px;opacity:.9;margin-top:10px;text-align:center}

    /* Animation background on empty side */
    #sideAnimation {
      position: absolute;
      right: 0;
      top: 0;
      width: 35%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index:0;
    }
    .bubble {
      position: absolute;
      bottom: -100px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 50%;
      animation: rise 12s infinite ease-in;
    }
    @keyframes rise {
      0% { transform: translateY(0) scale(1); opacity: 0.8; }
      50% { opacity: 0.5; }
      100% { transform: translateY(-110vh) scale(1.5); opacity: 0; }
    }

    @media(max-width:768px){
      .container{grid-template-columns:1fr}
      #sideAnimation{display:none;}
    }
  </style>
</head>
<body>
  <h1>‚ú® Smart Style Mirror ‚Äì Your AI Fashion Buddy üé§</h1>

  <div class="container">
    <div class="glass">
      <video id="video" autoplay playsinline muted></video>
      <canvas id="canvas" width="400" height="300"></canvas>
      <div id="controls">
        <button id="btnCapture">üì∏ Capture</button>
        <button id="btnVoice" class="secondary">Voice: ON üé§</button>
      </div>
      <div id="tip">
        ‚ö†Ô∏è Use Chrome + allow Camera & Mic. Open via <b>https://</b> or <b>localhost</b>.
      </div>
    </div>

    <div class="glass">
      <div id="suggestion">Initializing camera‚Ä¶</div>
      <div id="palette"></div>
      <div>
        <h3>üì∑ Captured Image</h3>
        <img id="captured" alt="Captured frame will appear here" />
        <a id="downloadLink" href="#" download="captured.png" class="hidden">‚¨á Download</a>
      </div>
    </div>
  </div>

  <!-- Floating bubble animation -->
  <div id="sideAnimation"></div>

  <button id="micButton" title="Ask Query">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 1 0-6 0v6a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 14 0h-2z"/>
      <path d="M19 11h2a9 9 0 0 1-18 0h2a7 7 0 0 0 14 0z"/>
    </svg>
  </button>

  <script>
    const video=document.getElementById('video');
    const canvas=document.getElementById('canvas');
    const ctx=canvas.getContext('2d');
    const suggestion=document.getElementById('suggestion');
    const captured=document.getElementById('captured');
    const downloadLink=document.getElementById('downloadLink');
    const paletteEl=document.getElementById('palette');
    const btnCapture=document.getElementById('btnCapture');
    const btnVoice=document.getElementById('btnVoice');
    const micButton=document.getElementById('micButton');

    let voiceEnabled=true;
    let faceColorName='Unknown';
    let currentPalette=[];
    let recognition=null;

    async function startCamera(){
      try{
        const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:true});
        video.srcObject=stream;
        suggestion.textContent='Camera Ready ‚úÖ';
      }catch(err){suggestion.textContent='üö´ Allow camera & mic permissions.';}
    }

    function startSampling(){
      setInterval(()=>{
        if(!video.srcObject)return;
        ctx.drawImage(video,0,0,canvas.width,canvas.height);
        const cx=Math.floor(canvas.width/2),cy=Math.floor(canvas.height/2);
        const pixel=ctx.getImageData(cx,cy,1,1).data;
        const [r,g,b]=pixel;
        faceColorName=getColorName(r,g,b);
        const palette=suggestDressPalette(faceColorName);
        currentPalette=palette;
        renderPalette(palette);
        suggestion.innerHTML=`üßë Face: <b>${faceColorName}</b><br>üëó Best: <b>${palette[0]}</b>`;
        if(voiceEnabled) speak(`Face color ${faceColorName}. Best dress ${palette[0]}.`);
      },4000);
    }

    function getColorName(r,g,b){
      const br=(r+g+b)/3;
      if(br<70)return"Very Dark Brown";
      if(br<100)return"Dark Brown";
      if(br<130)return"Medium Brown";
      if(br<160)return"Light Brown";
      if(br<190)return"Olive";
      if(br<220)return"Fair";
      return"Pale";
    }

    function suggestDressPalette(name){
      switch(name){
        case"Very Dark Brown":return["Bright Yellow","Electric Blue","Turquoise","Hot Pink","White"];
        case"Dark Brown":return["Sky Blue","Coral","Mustard","Mint Green","Lavender"];
        case"Medium Brown":return["Teal","Cobalt Blue","Peach","Olive Green","Magenta"];
        case"Light Brown":return["Royal Blue","Burnt Orange","Forest Green","Burgundy","Cream"];
        case"Olive":return["Purple","Fuchsia","Navy","Warm Beige","Cyan"];
        case"Fair":return["Maroon","Emerald","Charcoal","Navy","Chocolate"];
        case"Pale":return["Dark Green","Deep Purple","Rust","Teal","Black"];
        default:return["Gray","Navy","Black","White","Denim"];
      }
    }

    function colorToCSS(name){
      const map={"Bright Yellow":"yellow","Electric Blue":"dodgerblue","Turquoise":"turquoise","Hot Pink":"deeppink",
      "Sky Blue":"skyblue","Coral":"coral","Mustard":"goldenrod","Mint Green":"mediumspringgreen","Lavender":"lavender",
      "Teal":"teal","Cobalt Blue":"royalblue","Peach":"peachpuff","Olive Green":"olivedrab","Magenta":"magenta",
      "Royal Blue":"royalblue","Burnt Orange":"chocolate","Forest Green":"forestgreen","Burgundy":"maroon","Cream":"cornsilk",
      "Purple":"purple","Fuchsia":"fuchsia","Navy":"navy","Warm Beige":"wheat","Cyan":"cyan",
      "Maroon":"maroon","Emerald":"seagreen","Charcoal":"dimgray","Chocolate":"chocolate",
      "Dark Green":"darkgreen","Deep Purple":"indigo","Rust":"peru","Black":"black",
      "Gray":"gray","White":"white","Denim":"steelblue"};
      return map[name]||name;
    }

    function renderPalette(palette){
      paletteEl.innerHTML='';
      palette.forEach(c=>{
        const sw=document.createElement('div');
        sw.className='swatch';
        sw.style.background=colorToCSS(c);
        sw.title=c;
        paletteEl.appendChild(sw);
      });
    }

    function captureImage(){
      ctx.drawImage(video,0,0,canvas.width,canvas.height);
      const data=canvas.toDataURL('image/png');
      captured.src=data;
      downloadLink.href=data;
      downloadLink.classList.remove('hidden');
      if(voiceEnabled) speak('Image captured.');
    }

    function speak(t){
      const s=window.speechSynthesis;if(!s)return;
      const u=new SpeechSynthesisUtterance(t);u.lang='en-US';s.cancel();s.speak(u);
    }

    function setupRecognition(){
      const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
      if(!SR)return null;
      const rec=new SR();
      rec.lang='en-US';
      rec.onresult=e=>{
        const q=e.results[0][0].transcript.toLowerCase();
        handleQuery(q);
      };
      return rec;
    }

    function handleQuery(q){
      if(q.includes('face')) speak(`Face color is ${faceColorName}`);
      else if(q.includes('dress')) speak(`Best option ${currentPalette[0]}, others ${currentPalette.slice(1).join(', ')}`);
      else if(q.includes('capture')) captureImage();
      else if(q.includes('voice off')){voiceEnabled=false;speak('Voice off');}
      else if(q.includes('voice on')){voiceEnabled=true;speak('Voice on');}
      else speak('Say face color, dress options, capture, voice on or voice off.');
    }

    btnCapture.onclick=captureImage;
    btnVoice.onclick=()=>{voiceEnabled=!voiceEnabled;btnVoice.textContent=voiceEnabled?'Voice: ON üé§':'Voice: OFF üîá'};
    micButton.onclick=()=>{if(!recognition) recognition=setupRecognition(); if(recognition) recognition.start();};

    (async()=>{await startCamera();startSampling();recognition=setupRecognition();})();

    // Floating bubble animation
    function createBubble() {
      const bubble = document.createElement("div");
      bubble.classList.add("bubble");
      const size = Math.random() * 40 + 20; // 20‚Äì60px
      bubble.style.width = size + "px";
      bubble.style.height = size + "px";
      bubble.style.left = Math.random() * 100 + "%";
      bubble.style.animationDuration = (Math.random() * 8 + 6) + "s";
      document.getElementById("sideAnimation").appendChild(bubble);
      setTimeout(() => bubble.remove(), 15000);
    }
    setInterval(createBubble, 1200);
  </script>
</body>
</html>
